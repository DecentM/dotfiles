{
  "$schema": "https://opencode.ai/config.json",
  "share": "manual",
  "permission": {
    "*": "deny",

    // Blanket deny bash - use custom sh tool instead
    // The sh tool enforces its own permission allowlist and audits all commands
    "bash": "deny",

    // Custom shell tool with permission enforcement and auditing
    // See ~/.config/opencode/tools/sh.ts for implementation
    "sh": "allow",
    "sh_*": "allow",
    "edit": {
      "*": "allow",
      ".key": "deny",
      ".env": "deny",
      ".env.*": "deny",
      ".env.example": "allow",
    },
    "glob": {
      "*": "allow",
    },
    "webfetch": "allow",
    "websearch": "allow",
    "grep": "allow",
    "list": "allow",
    "lsp": "allow",
    "task": "allow",
    "todoread": "allow",
    "todowrite": "allow",
    "question": "allow",
    "read": {
      "*": "allow",
      ".env": "deny",
      ".env.*": "deny",
      ".env.example": "allow",
    },
    "codesearch": "allow",
    "skill": "allow",

    // MCPs
    "sequentialthinking_*": "allow",
    "memory_*": "allow",
    "time_*": "allow",
    "flaresolverr_*": "deny",

    // Sandbox MCPs - delegate to specialized agents
    "sandbox-node-deno_*": "deny",
    "sandbox-python_*": "deny",
  },
  "instructions": [
    "~/.dotfiles/opencode/rules/base.md",
    "AGENTS.md",
    ".cursorrules",
    ".cursor/rules/*.{md,mdx}",
  ],
  "mcp": {
    "sequentialthinking": {
      "type": "local",
      "command": [
        "docker",
        "run",
        "--rm",
        "-i",
        "--network=none",
        "--memory=512m",
        "--cpus=1",
        "mcp/sequentialthinking",
      ],
      "enabled": true,
    },
    "time": {
      "type": "local",
      "command": [
        "docker",
        "run",
        "--rm",
        "-i",
        "--network=none",
        "--memory=512m",
        "--cpus=1",
        "mcp/time",
      ],
      "enabled": true,
    },

    // Sandbox MCP servers for safe code execution (builds inline on first run)
    "sandbox-node-deno": {
      "type": "local",
      "command": [
        "bash",
        "-c",
        "docker run --rm -i --init --network=none --memory=512m --cpus=1 $(docker build -q -f ~/.dotfiles/opencode/docker/repl-mcp.dockerfile ~/.dotfiles/opencode/docker)",
      ],
      "enabled": true,
    },
    "sandbox-python": {
      "type": "local",
      "command": [
        "bash",
        "-c",
        "docker run --rm -i --init --network=none --memory=512m --cpus=1 $(docker build -q -f ~/.dotfiles/opencode/docker/mcp-python.dockerfile ~/.dotfiles/opencode/docker)",
      ],
      "enabled": true,
    },
    "flaresolverr": {
      "type": "local",
      "command": [
        "bash",
        "-c",
        // Bundled container: Flaresolverr + Chromium + MCP server (~900MB, needs more resources)
        "docker run --rm -i --init --shm-size=2g --memory=2g --cpus=2 $(docker build -q -f ~/.dotfiles/opencode/docker/mcp-flaresolverr.dockerfile ~/.dotfiles/opencode/docker)",
      ],
      "enabled": true,
    },
  },
}
