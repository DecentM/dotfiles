{
  "$schema": "https://opencode.ai/config.json",
  "share": "manual",
  "permission": {
    "*": "deny",
    "bash": {
      "kubectl patch*": "deny",
      "kubectl apply*": "deny",
      "flux*": "deny",

      "kubectl describe*": "allow",
      "kubectl get*": "allow",
      "kubectl logs*": "allow",
      "kubectl run*": "allow",
      "kubectl exec*": "allow",
      "kubectl wait*": "allow",
      "kubectl create job*": "allow",
      "kubectl delete job*": "allow",
      "kubectl version*": "allow",
      "kubectl version": "allow",

      "node -e*": "deny", // use sandbox-node MCP
      "python*": "deny", // use sandbox-python MCP

      "git add*": "deny",
      "git commit*": "deny",
      "git diff*": "allow",
      "git status": "allow",
      "git push": "deny",
      "git push*": "deny",
      "git log": "allow",
      "git log*": "allow",

      "grep*": "allow",
      "sed*": "allow",
      "uniq": "allow",
      "tail*": "allow",
      "tail": "allow",
      "head*": "allow",
      "head": "allow",
      "sort*": "allow",
      "sort": "allow",
      "awk*": "allow",
      "cut*": "allow",
      "wc*": "allow",
      "wc": "allow",
      "ping*": "allow",
      "curl*": "allow",
      "echo*": "allow",
      "echo": "allow",
      "printf*": "allow",
      "printf": "allow",
      "jq*": "allow",
      "jq": "allow",
      "ls*": "allow",
      "ls": "allow",
      "paste*": "allow",
      "column*": "allow",
      "xargs*": "allow",
      "find*": "allow",
      "npm info*": "allow",
      "cat*": "allow",
      "rg*": "allow", // ripgrep
      "basename*": "allow",
      "chmod*": "ask",
      "timeout*": "ask",
      "*.sh": "ask",

      "pnpm build": "allow",
      "pnpm install": "allow",
      "pnpm moon": "allow",

      "npm search*": "allow",
      "npm view*": "allow",

      "docker build*": "allow",

      "docker manifest inspect*": "allow",
    },
    "edit": {
      "*": "allow",
      ".key": "deny",
      ".env": "ask",
      ".env.*": "ask",
      ".env.example": "allow",
    },
    "glob": {
      "*": "allow",
    },
    "webfetch": "allow",
    "websearch": "allow",
    "grep": "allow",
    "list": "allow",
    "lsp": "allow",
    "task": "allow",
    "todoread": "allow",
    "todowrite": "allow",
    "question": "allow",
    "read": {
      "*": "allow",
      ".env": "ask",
      ".env.*": "ask",
      ".env.example": "ask",
    },
    "codesearch": "allow",
    "skill": "allow",

    // MCPs
    "sequentialthinking_*": "allow",
    "memory_*": "allow",
    "time_*": "allow",
    "playwright_*": "allow",

    // Sandbox MCPs - code execution in isolated containers
    "sandbox-node_*": "allow",
    "sandbox-python_*": "allow",
  },
  "agent": {
    "compaction": {
      "hidden": true,
      "prompt": "Write your memories into the memory tool. Then, provide a detailed prompt for continuing our conversation above. Focus on information that would be helpful for continuing the conversation, including what we did, what we're doing, which files we're working on, and what we're going to do next considering new session will not have access to our conversation.",
    },
  },
  "instructions": [
    "~/.dotfiles/opencode/rules/base.md",
    "AGENTS.md",
    ".cursor/rules/*.{md,mdx}",
  ],
  "mcp": {
    "sequentialthinking": {
      "type": "local",
      "command": ["docker", "run", "--rm", "-i", "mcp/sequentialthinking"],
      "enabled": true,
    },
    "time": {
      "type": "local",
      "command": ["docker", "run", "--rm", "-i", "mcp/time"],
      "enabled": true,
    },
    "playwright": {
      "type": "local",
      "command": [
        "docker",
        "run",
        "--rm",
        "-i",
        "--init",
        "mcr.microsoft.com/playwright/mcp",
      ],
      "enabled": true,
    },
    // Sandbox MCP servers for safe code execution (builds inline on first run)
    "sandbox-node": {
      "type": "local",
      "command": [
        "bash",
        "-c",
        "docker run --rm -i --init --network=none --memory=512m --cpus=1 $(docker build -q -f ~/.dotfiles/opencode/docker/repl-mcp.dockerfile ~/.dotfiles/opencode/docker)",
      ],
      "enabled": true,
    },
    "sandbox-python": {
      "type": "local",
      "command": [
        "bash",
        "-c",
        "docker run --rm -i --init --network=none --memory=512m --cpus=1 $(docker build -q -f ~/.dotfiles/opencode/docker/mcp-python.dockerfile ~/.dotfiles/opencode/docker)",
      ],
      "enabled": true,
    },
  },
}
