{
  "$schema": "https://opencode.ai/config.json",
  "share": "manual",
  "permission": {
    "*": "deny",
    "bash": {
      // Explicit denies - these override more general allows or need comments
      "python*": "deny", // use sandbox MCP
      "node*": "deny", // use sandbox MCP
      "rm*": "deny", // too dangerous, could match 'rmdir' pattern
      "htop*": "deny", // interactive, use top -bn1 instead

      // Infra - kubectl (no fallback allow, so denies not needed)
      "kubectl describe*": "allow",
      "kubectl get*": "allow",
      "kubectl logs*": "allow",
      "kubectl run*": "allow",
      "kubectl exec*": "allow",
      "kubectl wait*": "allow",
      "kubectl create job*": "allow",
      "kubectl delete job*": "allow",
      "kubectl version*": "allow",
      "kubectl version": "allow",
      "kubectl config view*": "allow",
      "kubectl config get*": "allow",
      "kubectl config current-context*": "allow",
      "kubectl cluster-info*": "allow",
      "kubectl api-resources*": "allow",
      "kubectl api-versions*": "allow",
      "kubectl explain*": "allow",
      "kubectl top*": "allow",
      "kubectl auth can-i*": "allow",
      "kubectl diff*": "allow",
      "kubectl events*": "allow",

      // Infra - helm (no fallback allow, so denies not needed)
      "helm list*": "allow",
      "helm status*": "allow",
      "helm get*": "allow",
      "helm show*": "allow",
      "helm search*": "allow",
      "helm repo list*": "allow",
      "helm history*": "allow",
      "helm template*": "allow",
      "helm lint*": "allow",
      "helm verify*": "allow",
      "helm version*": "allow",
      "helm env*": "allow",
      "helm dependency list*": "allow",

      // Infra - terraform (no fallback allow, so denies not needed)
      "terraform show*": "allow",
      "terraform validate*": "allow",
      "terraform fmt*": "allow",
      "terraform version*": "allow",
      "terraform output*": "allow",
      "terraform state list*": "allow",
      "terraform state show*": "allow",
      "terraform providers*": "allow",
      "terraform graph*": "allow",
      // End infra

      // Shell utils
      "*.sh": "ask",
      "bin/*": "ask",
      "./*": "ask",
      "true": "allow",
      "false": "allow",

      "grep*": "allow",
      "sed*": "allow",
      "uniq": "allow",
      "tail*": "allow",
      "tail": "allow",
      "head*": "allow",
      "head": "allow",
      "sort*": "allow",
      "sort": "allow",
      "awk*": "allow",
      "cut*": "allow",
      "wc*": "allow",
      "wc": "allow",
      "ping*": "allow",
      "curl*": "allow",
      "echo*": "allow",
      "echo": "allow",
      "printf*": "allow",
      "printf": "allow",
      "ls*": "allow",
      "ls": "allow",
      "paste*": "allow",
      "column*": "allow",
      "xargs*": "allow",
      "find*": "allow",
      "cat*": "allow",
      "rg*": "allow",
      "basename*": "allow",
      "tree*": "allow",
      "wget*": "allow",
      "jq*": "allow",
      "jq": "allow",
      "yq*": "allow",
      "yq": "allow",
      "uniq*": "allow",
      "pwd": "allow",
      "which*": "allow",
      "sleep*": "allow",
      "mkdir*": "allow",
      "dirname*": "allow",
      "touch*": "allow",
      "cp*": "allow",
      "cp -*": "allow",
      // End shell utils

      // System info - read-only
      "uname*": "allow",
      "hostname": "allow",
      "hostname -f": "allow",
      "hostname -I": "allow",
      "whoami": "allow",
      "id": "allow",
      "id*": "allow",
      "groups": "allow",
      "groups*": "allow",
      "uptime*": "allow",
      "free*": "allow",
      "df*": "allow",
      "du*": "allow",
      "lsblk*": "allow",
      "lscpu*": "allow",
      "lsmem*": "allow",
      "lspci*": "allow",
      "lsusb*": "allow",
      "lsmod*": "allow",
      "lsns*": "allow",
      "lsof*": "allow",
      "lsipc*": "allow",
      "lslocks*": "allow",
      "nproc*": "allow",
      "getconf*": "allow",
      "arch": "allow",
      "w": "allow",
      "who": "allow",
      "who*": "allow",
      "last*": "allow",
      "lastlog*": "allow",
      "getent*": "allow",
      "locale*": "allow",
      "timedatectl": "allow",
      "timedatectl status": "allow",
      "timedatectl show": "allow",
      "hostnamectl": "allow",
      "hostnamectl status": "allow",
      "loginctl list*": "allow",
      "loginctl show*": "allow",
      // End system info

      // Process info - read-only
      "ps*": "allow",
      "ps": "allow",
      "pgrep*": "allow",
      "pidof*": "allow",
      "top -bn1*": "allow",
      "pstree*": "allow",
      "fuser*": "allow",
      "jobs": "allow",
      "wait*": "allow",
      "watch*": "allow",
      // End process info

      // Logs and debug - read-only
      "journalctl*": "allow",
      "dmesg*": "allow",
      "systemctl status*": "allow",
      "systemctl is-active*": "allow",
      "systemctl is-enabled*": "allow",
      "systemctl is-failed*": "allow",
      "systemctl list-units*": "allow",
      "systemctl list-unit-files*": "allow",
      "systemctl list-timers*": "allow",
      "systemctl list-sockets*": "allow",
      "systemctl list-jobs*": "allow",
      "systemctl list-dependencies*": "allow",
      "systemctl show*": "allow",
      "systemctl cat*": "allow",
      "systemctl help*": "allow",
      "systemctl --version": "allow",
      "strace*": "allow",
      "ltrace*": "allow",
      // End logs and debug

      // File info and checksums - read-only
      "stat*": "allow",
      "file*": "allow",
      "readlink*": "allow",
      "realpath*": "allow",
      "namei*": "allow",
      "getfacl*": "allow",
      "lsattr*": "allow",
      "md5sum*": "allow",
      "sha1sum*": "allow",
      "sha256sum*": "allow",
      "sha512sum*": "allow",
      "sha224sum*": "allow",
      "sha384sum*": "allow",
      "b2sum*": "allow",
      "cksum*": "allow",
      "sum*": "allow",
      "diff*": "allow",
      "cmp*": "allow",
      "comm*": "allow",
      // End file info

      // Text processing
      "tr*": "allow",
      "tee*": "allow",
      "rev*": "allow",
      "nl*": "allow",
      "expand*": "allow",
      "unexpand*": "allow",
      "fold*": "allow",
      "fmt*": "allow",
      "join*": "allow",
      "split*": "allow",
      "csplit*": "allow",
      "colrm*": "allow",
      "pr*": "allow",
      "tsort*": "allow",
      "numfmt*": "allow",
      "base64*": "allow",
      "base32*": "allow",
      "od*": "allow",
      "xxd*": "allow",
      "hexdump*": "allow",
      "strings*": "allow",
      "iconv*": "allow",
      // End text processing

      // Network diagnostics - read-only
      "ip addr*": "allow",
      "ip link*": "allow",
      "ip route*": "allow",
      "ip neigh*": "allow",
      "ip -s*": "allow",
      "ip a*": "allow",
      "ip r*": "allow",
      "ss*": "allow",
      "netstat*": "allow",
      "ifconfig*": "allow",
      "route*": "allow",
      "dig*": "allow",
      "nslookup*": "allow",
      "host*": "allow",
      "traceroute*": "allow",
      "tracepath*": "allow",
      "mtr*": "allow",
      "whois*": "allow",
      "arp*": "allow",
      "ethtool*": "allow",
      "iwconfig*": "allow",
      "iw*": "allow",
      "nmcli*": "allow",
      "resolvectl*": "allow",
      // End network diagnostics

      // Archive operations - read/extract only
      "tar tf*": "allow",
      "tar tvf*": "allow",
      "tar xf*": "allow",
      "tar xvf*": "allow",
      "tar xzf*": "allow",
      "tar xjf*": "allow",
      "tar --list*": "allow",
      "tar -tf*": "allow",
      "tar -tvf*": "allow",
      "tar -xf*": "allow",
      "tar -xvf*": "allow",
      "tar -xzf*": "allow",
      "tar -xjf*": "allow",
      "unzip*": "allow",
      "zipinfo*": "allow",
      "zcat*": "allow",
      "zless*": "allow",
      "zmore*": "allow",
      "zgrep*": "allow",
      "gunzip*": "allow",
      "gzip -l*": "allow",
      "gzip -t*": "allow",
      "xz -l*": "allow",
      "xz -t*": "allow",
      "xzcat*": "allow",
      "unxz*": "allow",
      "bzip2 -d*": "allow",
      "bunzip2*": "allow",
      "bzcat*": "allow",
      "7z l*": "allow",
      "7z x*": "allow",
      "7z e*": "allow",
      "unrar*": "allow",
      // End archive operations

      // Date, time, math utilities
      "date*": "allow",
      "cal*": "allow",
      "ncal*": "allow",
      "bc*": "allow",
      "dc*": "allow",
      "expr*": "allow",
      "seq*": "allow",
      "shuf*": "allow",
      "factor*": "allow",
      // End date/time/math

      // Environment inspection - env without args is safe, with args can run commands
      "env": "allow",
      "printenv*": "allow",
      "set": "allow",
      "declare -p*": "allow",
      "type*": "allow",
      "command -v*": "allow",
      "hash*": "allow",
      // End environment

      // Man pages and help
      "man*": "allow",
      "info*": "allow",
      "apropos*": "allow",
      "whatis*": "allow",
      "tldr*": "allow",
      "help*": "allow",
      // End man pages

      // Build tools
      "make*": "allow",
      "cmake*": "allow",
      "ninja*": "allow",
      "meson*": "allow",
      "autoconf*": "allow",
      "automake*": "allow",
      "configure*": "allow",
      "gcc*": "allow",
      "g++*": "allow",
      "clang*": "allow",
      "clang++*": "allow",
      "cc*": "allow",
      "c++*": "allow",
      "ld*": "allow",
      "ar*": "allow",
      "nm*": "allow",
      "objdump*": "allow",
      "readelf*": "allow",
      "size*": "allow",
      "go build*": "allow",
      "go test*": "allow",
      "go run*": "allow",
      "go mod*": "allow",
      "go fmt*": "allow",
      "go vet*": "allow",
      "go doc*": "allow",
      "go list*": "allow",
      "go env*": "allow",
      "go version*": "allow",
      "go generate*": "allow",
      "go clean*": "allow",
      "rustc*": "allow",
      "rustup show*": "allow",
      "rustup which*": "allow",
      "rustup doc*": "allow",
      "rustup --version": "allow",
      "rustfmt*": "allow",
      "rust-analyzer*": "allow",
      // End build tools

      // Package management - no fallback allow, specific commands only
      // npm - read-only and safe commands
      "npm info*": "allow",
      "npm run*": "allow",
      "npm audit*": "allow",
      "npm search*": "allow",
      "npm view*": "allow",
      "npm list*": "allow",
      "npm ls*": "allow",
      "npm outdated*": "allow",
      "npm explain*": "allow",
      "npm why*": "allow",
      "npm fund*": "allow",
      "npm doctor*": "allow",
      "npm prefix*": "allow",
      "npm root*": "allow",
      "npm bin*": "allow",
      "npm config list*": "allow",
      "npm config get*": "allow",
      "npm pack*": "allow",
      "npm version": "allow",
      "npm help*": "allow",
      "npm exec*": "allow",
      "npm test*": "allow",
      "npm start*": "allow",
      "npm rebuild*": "allow",
      "npm dedupe*": "allow",
      "npm prune*": "allow",

      // yarn - read-only and safe commands
      "yarn audit*": "allow",
      "yarn info*": "allow",
      "yarn list*": "allow",
      "yarn why*": "allow",
      "yarn outdated*": "allow",
      "yarn config list*": "allow",
      "yarn config get*": "allow",
      "yarn version": "allow",
      "yarn versions": "allow",
      "yarn cache list*": "allow",
      "yarn workspaces list*": "allow",
      "yarn licenses list*": "allow",
      "yarn run*": "allow",
      "yarn build*": "allow",
      "yarn test*": "allow",
      "yarn lint*": "allow",
      "yarn start*": "allow",
      "yarn dedupe*": "allow",
      "yarn explain*": "allow",
      "yarn pack*": "allow",
      "yarn help*": "allow",

      // pnpm - read-only and safe commands
      "pnpm audit*": "allow",
      "pnpm list*": "allow",
      "pnpm ls*": "allow",
      "pnpm outdated*": "allow",
      "pnpm why*": "allow",
      "pnpm licenses list*": "allow",
      "pnpm run*": "allow",
      "pnpm exec*": "allow",
      "pnpm env list*": "allow",
      "pnpm root*": "allow",
      "pnpm bin*": "allow",
      "pnpm prefix*": "allow",
      "pnpm store status*": "allow",
      "pnpm config list*": "allow",
      "pnpm config get*": "allow",
      "pnpm build": "allow",
      "pnpm test": "allow",
      "pnpm start": "allow",
      "pnpm moon": "allow",
      "pnpm dedupe*": "allow",
      "pnpm rebuild*": "allow",
      "pnpm prune*": "allow",
      "pnpm pack*": "allow",
      "pnpm help*": "allow",

      // bun - read-only and safe commands
      "bun run*": "allow",
      "bun test*": "allow",
      "bun build*": "allow",
      "bun pm ls*": "allow",
      "bun pm cache*": "allow",
      "bun outdated*": "allow",
      "bun --version": "allow",
      "bun --help": "allow",

      // cargo - read-only and safe commands
      "cargo check*": "allow",
      "cargo build*": "allow",
      "cargo test*": "allow",
      "cargo run*": "allow",
      "cargo doc*": "allow",
      "cargo bench*": "allow",
      "cargo tree*": "allow",
      "cargo metadata*": "allow",
      "cargo search*": "allow",
      "cargo info*": "allow",
      "cargo fetch*": "allow",
      "cargo verify-project*": "allow",
      "cargo locate-project*": "allow",
      "cargo read-manifest*": "allow",
      "cargo pkgid*": "allow",
      "cargo generate-lockfile*": "allow",
      "cargo clippy*": "allow",
      "cargo fmt*": "allow",
      "cargo audit*": "allow",
      "cargo fix*": "allow",
      "cargo clean*": "allow",
      "cargo vendor*": "allow",
      "cargo version*": "allow",
      "cargo --version": "allow",
      "cargo help*": "allow",
      // End package management

      // Build and test
      "tsc*": "allow",
      "eslint*": "allow",
      "prettier*": "allow",
      "jest*": "allow",
      "vitest*": "allow",
      "pytest*": "allow",
      "time*": "allow",
      "hyperfine*": "allow",
      "perf*": "allow",
      // End build and test

      // Containers
      // Fallback deny for docker commands - specific commands allowed below
      "docker*": "deny",
      "docker-compose*": "deny",

      // docker - read-only and safe commands
      "docker build*": "allow",
      "docker manifest inspect*": "allow",
      "docker search*": "allow",
      "docker pull*": "allow",
      "docker logs*": "allow",
      "docker images*": "allow",
      "docker run*": "allow",
      "docker ps*": "allow",
      "docker inspect*": "allow",
      "docker info*": "allow",
      "docker info": "allow",
      "docker version*": "allow",
      "docker version": "allow",
      "docker stats*": "allow",
      "docker top*": "allow",
      "docker port*": "allow",
      "docker diff*": "allow",
      "docker history*": "allow",
      "docker events*": "allow",
      "docker cp*": "allow",
      "docker tag*": "allow",
      "docker network ls*": "allow",
      "docker network inspect*": "allow",
      "docker volume ls*": "allow",
      "docker volume inspect*": "allow",
      "docker system df*": "allow",
      "docker system info*": "allow",
      "docker container ls*": "allow",
      "docker container logs*": "allow",
      "docker container inspect*": "allow",
      "docker image ls*": "allow",
      "docker image inspect*": "allow",
      "docker image history*": "allow",
      "docker buildx*": "allow",
      "docker context*": "allow",
      "docker help*": "allow",
      "docker --version": "allow",
      "docker --help": "allow",

      // docker compose - read-only and safe commands
      "docker compose ps*": "allow",
      "docker compose logs*": "allow",
      "docker compose config*": "allow",
      "docker compose top*": "allow",
      "docker compose images*": "allow",
      "docker compose port*": "allow",
      "docker compose version*": "allow",
      "docker compose ls*": "allow",
      "docker compose --help": "allow",
      "docker-compose ps*": "allow",
      "docker-compose logs*": "allow",
      "docker-compose config*": "allow",
      "docker-compose top*": "allow",
      "docker-compose images*": "allow",
      "docker-compose port*": "allow",
      "docker-compose version*": "allow",
      "docker-compose --help": "allow",

      // distrobox - read-only commands only
      "distrobox*": "deny",
      "distrobox list*": "allow",
      "distrobox ls*": "allow",
      "distrobox version*": "allow",
      "distrobox --help": "allow",
      "distrobox-export --list-apps*": "allow",
      "distrobox-export --list-binaries*": "allow",
      "distrobox-export --help": "allow",
      "distrobox-export --version": "allow"
      // End containers
    },
    "edit": {
      "*": "allow",
      ".key": "deny",
      ".env": "deny",
      ".env.*": "deny",
      ".env.example": "allow",
    },
    "glob": {
      "*": "allow",
    },
    "webfetch": "allow",
    "websearch": "allow",
    "grep": "allow",
    "list": "allow",
    "lsp": "allow",
    "task": "allow",
    "todoread": "allow",
    "todowrite": "allow",
    "question": "allow",
    "read": {
      "*": "allow",
      ".env": "deny",
      ".env.*": "deny",
      ".env.example": "allow",
    },
    "codesearch": "allow",
    "skill": "allow",

    // MCPs
    "sequentialthinking_*": "allow",
    "memory_*": "allow",
    "time_*": "allow",
    "flaresolverr_*": "deny",

    // Sandbox MCPs - delegate to specialized agents
    "sandbox-node-deno_*": "deny",
    "sandbox-python_*": "deny",
  },
  "instructions": [
    "~/.dotfiles/opencode/rules/base.md",
    "AGENTS.md",
    ".cursorrules",
    ".cursor/rules/*.{md,mdx}",
  ],
  "mcp": {
    "sequentialthinking": {
      "type": "local",
      "command": [
        "docker",
        "run",
        "--rm",
        "-i",
        "--network=none",
        "--memory=512m",
        "--cpus=1",
        "mcp/sequentialthinking",
      ],
      "enabled": true,
    },
    "time": {
      "type": "local",
      "command": [
        "docker",
        "run",
        "--rm",
        "-i",
        "--network=none",
        "--memory=512m",
        "--cpus=1",
        "mcp/time",
      ],
      "enabled": true,
    },

    // Sandbox MCP servers for safe code execution (builds inline on first run)
    "sandbox-node-deno": {
      "type": "local",
      "command": [
        "bash",
        "-c",
        "docker run --rm -i --init --network=none --memory=512m --cpus=1 $(docker build -q -f ~/.dotfiles/opencode/docker/repl-mcp.dockerfile ~/.dotfiles/opencode/docker)",
      ],
      "enabled": true,
    },
    "sandbox-python": {
      "type": "local",
      "command": [
        "bash",
        "-c",
        "docker run --rm -i --init --network=none --memory=512m --cpus=1 $(docker build -q -f ~/.dotfiles/opencode/docker/mcp-python.dockerfile ~/.dotfiles/opencode/docker)",
      ],
      "enabled": true,
    },
    "flaresolverr": {
      "type": "local",
      "command": [
        "bash",
        "-c",
        // Bundled container: Flaresolverr + Chromium + MCP server (~900MB, needs more resources)
        "docker run --rm -i --init --shm-size=2g --memory=2g --cpus=2 $(docker build -q -f ~/.dotfiles/opencode/docker/mcp-flaresolverr.dockerfile ~/.dotfiles/opencode/docker)",
      ],
      "enabled": true,
    },
  },
}
