{
  "$schema": "https://opencode.ai/config.json",
  "share": "manual",
  "permission": {
    "*": "deny",
    "bash": {
      "python*": "deny", // use sandbox MCP
      "node*": "deny", // use sandbox MCP

      // Infra
      "kubectl patch*": "deny",
      "kubectl apply*": "deny",
      "flux*": "deny",

      "kubectl describe*": "allow",
      "kubectl get*": "allow",
      "kubectl logs*": "allow",
      "kubectl run*": "allow",
      "kubectl exec*": "allow",
      "kubectl wait*": "allow",
      "kubectl create job*": "allow",
      "kubectl delete job*": "allow",
      "kubectl version*": "allow",
      "kubectl version": "allow",

      "helm list*": "allow",
      "helm status*": "allow",
      "terraform plan*": "ask",
      "terraform show*": "allow",
      // End infra

      // Shell utils
      "chmod*": "ask",
      "timeout*": "ask",
      "*.sh": "ask",

      "grep*": "allow",
      "sed*": "allow",
      "uniq": "allow",
      "tail*": "allow",
      "tail": "allow",
      "head*": "allow",
      "head": "allow",
      "sort*": "allow",
      "sort": "allow",
      "awk*": "allow",
      "cut*": "allow",
      "wc*": "allow",
      "wc": "allow",
      "ping*": "allow",
      "curl*": "allow",
      "echo*": "allow",
      "echo": "allow",
      "printf*": "allow",
      "printf": "allow",
      "ls*": "allow",
      "ls": "allow",
      "paste*": "allow",
      "column*": "allow",
      "xargs*": "allow",
      "find*": "allow",
      "cat*": "allow",
      "rg*": "allow",
      "basename*": "allow",
      "tree*": "allow",
      "wget*": "allow",
      "jq*": "allow",
      "jq": "allow",
      "uniq*": "allow",
      "pwd": "allow",
      // End shell utils

      // Package management
      "yarn*": "ask",
      "pnpm*": "ask",
      "bun*": "ask",
      "cargo*": "ask",
      "npm*": "ask",
      "npx*": "ask",

      "npm info*": "allow",
      "npm run*": "allow",
      "npm audit*": "allow",
      "npm search*": "allow",
      "npm view*": "allow",
      "yarn audit*": "allow",
      "pnpm audit*": "allow",
      "pnpm build": "allow",
      "pnpm install": "ask",
      "pnpm moon": "allow",
      // End package management

      // Build and test
      "tsc*": "allow",
      "eslint*": "allow",
      "prettier*": "allow",
      "jest*": "allow",
      "vitest*": "allow",
      "pytest*": "allow",
      "time*": "allow",
      "hyperfine*": "allow",
      "perf*": "ask",
      // End build and test

      // Docker
      "docker*": "ask",
      "docker-compose*": "ask",

      "docker build*": "allow",
      "docker manifest inspect*": "allow",
      // End docker

      // Git
      "git status": "allow",
      "git bisect*": "allow",
      "git log": "allow",
      "git status*": "allow",
      "git log*": "allow",
      "git diff*": "allow",
      "git show*": "allow",
      "git blame*": "allow",
      "git branch*": "allow",
      "git rev-parse*": "allow",
      "git reflog*": "allow",
      "git stash list*": "allow",
      "git config --get*": "allow",
      "git ls-files*": "allow",
      "git shortlog*": "allow",
      "git rev-list*": "allow",
      // End git
    },
    "edit": {
      "*": "allow",
      ".key": "deny",
      ".env": "ask",
      ".env.*": "ask",
      ".env.example": "allow",
    },
    "glob": {
      "*": "allow",
    },
    "webfetch": "allow",
    "websearch": "allow",
    "grep": "allow",
    "list": "allow",
    "lsp": "allow",
    "task": "allow",
    "todoread": "allow",
    "todowrite": "allow",
    "question": "allow",
    "read": {
      "*": "allow",
      ".env": "ask",
      ".env.*": "ask",
      ".env.example": "ask",
    },
    "codesearch": "allow",
    "skill": "allow",

    // MCPs
    "sequentialthinking_*": "allow",
    "memory_*": "allow",
    "time_*": "allow",
    "playwright_*": "allow",

    // Sandbox MCPs - code execution in isolated containers
    "sandbox-node-deno_*": "allow",
    "sandbox-python_*": "allow",
  },
  "agent": {
    "compaction": {
      "hidden": true,
      "prompt": "Write your memories into the memory tool. Then, provide a detailed prompt for continuing our conversation above. Focus on information that would be helpful for continuing the conversation, including what we did, what we're doing, which files we're working on, and what we're going to do next considering new session will not have access to our conversation.",
    },
  },
  "instructions": [
    "~/.dotfiles/opencode/rules/base.md",
    "AGENTS.md",
    ".cursor/rules/*.{md,mdx}",
  ],
  "mcp": {
    "sequentialthinking": {
      "type": "local",
      "command": [
        "docker",
        "run",
        "--rm",
        "-i",
        "--network=none",
        "--memory=512m",
        "--cpus=1",
        "mcp/sequentialthinking",
      ],
      "enabled": true,
    },
    "time": {
      "type": "local",
      "command": [
        "docker",
        "run",
        "--rm",
        "-i",
        "--network=none",
        "--memory=512m",
        "--cpus=1",
        "mcp/time",
      ],
      "enabled": true,
    },
    "playwright": {
      "type": "local",
      "command": [
        "docker",
        "run",
        "--rm",
        "-i",
        "--init",
        "--memory=2048m",
        "--cpus=2",
        "mcr.microsoft.com/playwright/mcp",
      ],
      "enabled": true,
    },
    // Sandbox MCP servers for safe code execution (builds inline on first run)
    "sandbox-node-deno": {
      "type": "local",
      "command": [
        "bash",
        "-c",
        "docker run --rm -i --init --network=none --memory=512m --cpus=1 $(docker build -q -f ~/.dotfiles/opencode/docker/repl-mcp.dockerfile ~/.dotfiles/opencode/docker)",
      ],
      "enabled": true,
    },
    "sandbox-python": {
      "type": "local",
      "command": [
        "bash",
        "-c",
        "docker run --rm -i --init --network=none --memory=512m --cpus=1 $(docker build -q -f ~/.dotfiles/opencode/docker/mcp-python.dockerfile ~/.dotfiles/opencode/docker)",
      ],
      "enabled": true,
    },
  },
}
