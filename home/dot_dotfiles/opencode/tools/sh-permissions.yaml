# Shell command permissions for the sh custom tool
# Patterns are matched in order - first match wins
# Default action if no pattern matches: deny
#
# Format:
#   pattern: glob pattern (* matches any characters) - for single patterns
#   patterns: array of glob patterns - for multiple patterns with same decision/reason
#   decision: allow | deny
#   reason: explanation shown to model when denied (helps it adapt)
#
# Constraints (for allowed commands):
#   constraints: array of constraints (all must pass)
#
# Constraint types:
#   cwd_only        - paths must be within working directory
#                     options: also_allow: ["/tmp"], exclude: [".git", ".env*"]
#   no_recursive    - block -r, -R, --recursive flags
#   no_force        - block -f, --force flags
#   max_depth       - require -maxdepth N where N <= value
#                     options: value: 5
#   require_flag    - require specific flag to be present
#                     options: flag: "--dry-run"

default: deny
default_reason: "Command not in allowlist - if you need this command, the user needs to run it, or request it be added to permissions"

rules:
  # ─────────────────────────────────────────────────────────────────────────────
  # Directory navigation - constrained to cwd
  # ─────────────────────────────────────────────────────────────────────────────
  - pattern: "cd *"
    decision: deny
    reason: "Set the workdir instead. If two separate commands are used, make separate tool calls"

  - pattern: "cd"
    decision: deny
    reason: "cd with no arguments goes to home directory - use 'cd .' or specify a path within cwd"

  # ─────────────────────────────────────────────────────────────────────────────
  # Explicit denies - dangerous or restricted commands
  # ─────────────────────────────────────────────────────────────────────────────
  - patterns:
      - "python*"
      - "python3*"
    decision: deny
    reason: "Use python tool for Python execution - it provides isolated containers"

  - patterns:
      - "node*"
    decision: deny
    reason: "Use node tool for execution - it provides isolated containers"

  # Bun - specific allows before general deny
  - patterns:
      - "bun run"
      - "bun run *"
      - "bun test"
      - "bun test *"
      - "bun build"
      - "bun build *"
      - "bun install"
      - "bun install *"
      - "bun add *"
      - "bun pm ls"
      - "bun pm ls *"
      - "bun pm cache"
      - "bun pm cache *"
      - "bun outdated"
      - "bun outdated *"
      - "bun --version"
      - "bun --help"
    decision: allow

  - patterns:
      - "bun remove"
      - "bun remove *"
    decision: deny
    reason: "Removing packages requires user confirmation - the user needs to run this command"

  - patterns:
      - "bun"
      - "bun *"
    decision: deny
    reason: "Use node MCP for Bun execution - it provides isolated containers"

  - patterns:
      - "rm"
      - "rm *"
    decision: deny
    reason: "File/directory deletion is not permitted - the user needs to delete manually"

  - patterns:
      - "mv"
      - "mv *"
    decision: deny
    reason: "File moving/renaming via shell is not permitted - use the edit tool or ask the user"

  - patterns:
      - "chmod"
      - "chmod *"
    decision: deny
    reason: "Permission changes are not permitted - the user needs to change permissions manually"

  - patterns:
      - "chown"
      - "chown *"
    decision: deny
    reason: "Ownership changes are not permitted - the user needs to change ownership manually"

  - patterns:
      - "sudo"
      - "sudo *"
    decision: deny
    reason: "Elevated privileges are not permitted - the user needs to run privileged commands"

  - patterns:
      - "su"
      - "su *"
    decision: deny
    reason: "User switching is not permitted"

  - patterns:
      - "htop"
      - "htop *"
    decision: deny
    reason: "Interactive programs don't work - use 'top -bn1' for a snapshot instead"

  - patterns:
      - "vim"
      - "vim *"
      - "nano"
      - "nano *"
      - "emacs"
      - "emacs *"
    decision: deny
    reason: "Interactive editors don't work - use the edit/write tools instead"

  - patterns:
      - "less"
      - "less *"
      - "more"
      - "more *"
    decision: deny
    reason: "Interactive pagers don't work - use cat, head, or tail instead"

  # Shell scripts - need review
  - pattern: "*.sh"
    decision: deny
    reason: "Shell scripts need user review before execution - describe what the script does and the user needs to run it"

  - patterns:
      - "bash"
      - "bash *"
      - "zsh"
      - "zsh *"
      - "sh *"
    decision: deny
    reason: "Use the sh tool directly - nested shell invocation is not permitted"

  - pattern: "bin/*"
    decision: deny
    reason: "Scripts in bin/ need user review - describe what the script does and the user needs to run it"

  - pattern: "./*"
    decision: deny
    reason: "Relative executables need user review - describe what it does and the user needs to run it"

  - patterns:
      - "eval"
      - "eval *"
    decision: deny
    reason: "Dynamic code evaluation is not permitted for security reasons"

  - patterns:
      - "exec"
      - "exec *"
    decision: deny
    reason: "Process replacement is not permitted"

  - patterns:
      - "source"
      - "source *"
    decision: deny
    reason: "Sourcing scripts is not permitted - run commands directly"

  # ─────────────────────────────────────────────────────────────────────────────
  # Containers - Docker
  # ─────────────────────────────────────────────────────────────────────────────
  - patterns:
      - "docker *"
      - "docker-compose"
      - "docker-compose *"
    decision: deny
    reason: "Docker is not available using sh. Use the docker tool instead"

  # Distrobox - read-only only
  - patterns:
      - "distrobox list"
      - "distrobox list *"
      - "distrobox ls"
      - "distrobox ls *"
      - "distrobox version"
      - "distrobox version *"
      - "distrobox --help"
      - "distrobox-export --list-apps"
      - "distrobox-export --list-apps *"
      - "distrobox-export --list-binaries"
      - "distrobox-export --list-binaries *"
      - "distrobox-export --help"
      - "distrobox-export --version"
    decision: allow

  - patterns:
      - "distrobox"
      - "distrobox *"
    decision: deny
    reason: "Distrobox container management requires user confirmation - the user needs to run this command"

  # ─────────────────────────────────────────────────────────────────────────────
  # Infrastructure - kubectl
  # ─────────────────────────────────────────────────────────────────────────────
  - patterns:
      - "kubectl apply"
      - "kubectl apply *"
      - "kubectl delete"
      - "kubectl delete *"
      - "kubectl create"
      - "kubectl create *"
      - "kubectl patch"
      - "kubectl patch *"
      - "kubectl scale"
      - "kubectl scale *"
      - "kubectl rollout"
      - "kubectl rollout *"
    decision: deny
    reason: "Mutating Kubernetes resources requires user confirmation - the user needs to run this command"

  - patterns:
      - "kubectl edit"
      - "kubectl edit *"
    decision: deny
    reason: "Interactive editing doesn't work - use kubectl get -o yaml, modify, then ask user to apply"

  - patterns:
      - "kubectl describe"
      - "kubectl describe *"
      - "kubectl get"
      - "kubectl get *"
      - "kubectl logs"
      - "kubectl logs *"
      - "kubectl run"
      - "kubectl run *"
      - "kubectl exec"
      - "kubectl exec *"
      - "kubectl wait"
      - "kubectl wait *"
      - "kubectl create job"
      - "kubectl create job *"
      - "kubectl delete job"
      - "kubectl delete job *"
      - "kubectl version"
      - "kubectl version *"
      - "kubectl config view"
      - "kubectl config view *"
      - "kubectl config get"
      - "kubectl config get *"
      - "kubectl config current-context"
      - "kubectl config current-context *"
      - "kubectl cluster-info"
      - "kubectl cluster-info *"
      - "kubectl api-resources"
      - "kubectl api-resources *"
      - "kubectl api-versions"
      - "kubectl api-versions *"
      - "kubectl explain"
      - "kubectl explain *"
      - "kubectl top"
      - "kubectl top *"
      - "kubectl auth can-i"
      - "kubectl auth can-i *"
      - "kubectl diff"
      - "kubectl diff *"
      - "kubectl events"
      - "kubectl events *"
    decision: allow

  # ─────────────────────────────────────────────────────────────────────────────
  # Infrastructure - helm
  # ─────────────────────────────────────────────────────────────────────────────
  - patterns:
      - "helm install"
      - "helm install *"
      - "helm upgrade"
      - "helm upgrade *"
      - "helm uninstall"
      - "helm uninstall *"
      - "helm rollback"
      - "helm rollback *"
    decision: deny
    reason: "Mutating Helm releases requires user confirmation - the user needs to run this command"

  - patterns:
      - "helm list"
      - "helm list *"
      - "helm status"
      - "helm status *"
      - "helm get"
      - "helm get *"
      - "helm show"
      - "helm show *"
      - "helm search"
      - "helm search *"
      - "helm repo list"
      - "helm repo list *"
      - "helm history"
      - "helm history *"
      - "helm template"
      - "helm template *"
      - "helm lint"
      - "helm lint *"
      - "helm verify"
      - "helm verify *"
      - "helm version"
      - "helm version *"
      - "helm env"
      - "helm env *"
      - "helm dependency list"
      - "helm dependency list *"
    decision: allow

  # ─────────────────────────────────────────────────────────────────────────────
  # Infrastructure - terraform
  # ─────────────────────────────────────────────────────────────────────────────
  - patterns:
      - "terraform apply"
      - "terraform apply *"
      - "terraform destroy"
      - "terraform destroy *"
      - "terraform import"
      - "terraform import *"
      - "terraform taint"
      - "terraform taint *"
      - "terraform untaint"
      - "terraform untaint *"
    decision: deny
    reason: "Mutating Terraform resources requires user confirmation - the user needs to run this command"

  - patterns:
      - "terraform init"
      - "terraform init *"
      - "terraform plan"
      - "terraform plan *"
      - "terraform show"
      - "terraform show *"
      - "terraform validate"
      - "terraform validate *"
      - "terraform fmt"
      - "terraform fmt *"
      - "terraform version"
      - "terraform version *"
      - "terraform output"
      - "terraform output *"
      - "terraform state list"
      - "terraform state list *"
      - "terraform state show"
      - "terraform state show *"
      - "terraform providers"
      - "terraform providers *"
      - "terraform graph"
      - "terraform graph *"
    decision: allow

  # ─────────────────────────────────────────────────────────────────────────────
  # Shell utilities - with path constraints
  # ─────────────────────────────────────────────────────────────────────────────

  # File reading - constrained to cwd
  - patterns:
      - "cat"
      - "cat *"
      - "head"
      - "head *"
      - "tail"
      - "tail *"
    decision: allow
    constraints:
      - cwd_only
    reason: "Cannot read files outside working directory"

  # Search commands - constrained to cwd
  - patterns:
      - "grep *"
      - "rg *"
    decision: allow
    constraints:
      - cwd_only
    reason: "Cannot search outside working directory"

  # Find - constrained to cwd with depth limit
  - patterns:
      - "find *"
    decision: allow
    constraints:
      - type: cwd_only
        exclude:
          - node_modules
          - .git
      - type: max_depth
        value: 10
    reason: "find must stay within cwd, exclude heavy dirs, and specify -maxdepth"

  # Directory listing - constrained to cwd
  - patterns:
      - "ls"
      - "ls *"
      - "tree"
      - "tree *"
    decision: allow
    constraints:
      - cwd_only
    reason: "Cannot list directories outside working directory"

  # Disk usage - constrained to cwd
  - patterns:
      - "du"
      - "du *"
    decision: allow
    constraints:
      - cwd_only
    reason: "Cannot check disk usage outside working directory"

  # File info - constrained to cwd
  - patterns:
      - "stat"
      - "stat *"
      - "file"
      - "file *"
    decision: allow
    constraints:
      - cwd_only
    reason: "Cannot get file info outside working directory"

  # File creation - constrained to cwd
  - patterns:
      - "mkdir"
      - "mkdir *"
      - "touch"
      - "touch *"
    decision: allow
    constraints:
      - cwd_only
    reason: "Cannot create files/directories outside working directory"

  # Copy and link - constrained to cwd, no recursive
  - patterns:
      - "cp"
      - "cp *"
      - "ln"
      - "ln *"
    decision: allow
    constraints:
      - cwd_only
      - no_recursive
    reason: "cp/ln constrained to cwd and non-recursive"

  # Non-path shell utilities - no constraints needed
  - patterns:
      - "true"
      - "false"
      - "sed *"
      - "uniq"
      - "uniq *"
      - "sort"
      - "sort *"
      - "awk *"
      - "cut *"
      - "wc"
      - "wc *"
      - "ping *"
      - "curl *"
      - "echo"
      - "echo *"
      - "printf"
      - "printf *"
      - "paste"
      - "paste *"
      - "column"
      - "column *"
      - "xargs *"
      - "basename"
      - "basename *"
      - "wget *"
      - "jq"
      - "jq *"
      - "yq"
      - "yq *"
      - "pwd"
      - "which *"
      - "sleep *"
      - "dirname"
      - "dirname *"
    decision: allow

  # ─────────────────────────────────────────────────────────────────────────────
  # System info - read-only
  # ─────────────────────────────────────────────────────────────────────────────
  - patterns:
      - "uname"
      - "uname *"
      - "hostname"
      - "hostname -f"
      - "hostname -I"
      - "whoami"
      - "id"
      - "id *"
      - "groups"
      - "groups *"
      - "uptime"
      - "uptime *"
      - "free"
      - "free *"
      - "df"
      - "df *"
      - "du"
      - "du *"
      - "lsblk"
      - "lsblk *"
      - "lscpu"
      - "lscpu *"
      - "lsmem"
      - "lsmem *"
      - "lspci"
      - "lspci *"
      - "lsusb"
      - "lsusb *"
      - "lsmod"
      - "lsmod *"
      - "lsns"
      - "lsns *"
      - "lsof"
      - "lsof *"
      - "lsipc"
      - "lsipc *"
      - "lslocks"
      - "lslocks *"
      - "nproc"
      - "nproc *"
      - "getconf"
      - "getconf *"
      - "arch"
      - "w"
      - "who"
      - "who *"
      - "last"
      - "last *"
      - "lastlog"
      - "lastlog *"
      - "getent *"
      - "locale"
      - "locale *"
      - "timedatectl"
      - "timedatectl status"
      - "timedatectl show"
      - "hostnamectl"
      - "hostnamectl status"
      - "loginctl list"
      - "loginctl list *"
      - "loginctl show"
      - "loginctl show *"
    decision: allow

  # ─────────────────────────────────────────────────────────────────────────────
  # Process info - read-only
  # ─────────────────────────────────────────────────────────────────────────────
  - patterns:
      - "ps"
      - "ps *"
      - "pgrep *"
      - "pidof *"
      - "top -bn1"
      - "top -bn1 *"
      - "pstree"
      - "pstree *"
      - "fuser *"
      - "jobs"
      - "wait"
      - "wait *"
      - "watch *"
    decision: allow

  # Process control - deny
  - patterns:
      - "kill *"
      - "pkill *"
      - "killall *"
    decision: deny
    reason: "Killing processes requires user confirmation - the user needs to run this command"

  # ─────────────────────────────────────────────────────────────────────────────
  # Logs and debug - read-only
  # ─────────────────────────────────────────────────────────────────────────────
  - patterns:
      - "journalctl"
      - "journalctl *"
      - "dmesg"
      - "dmesg *"
      - "systemctl status"
      - "systemctl status *"
      - "systemctl is-active"
      - "systemctl is-active *"
      - "systemctl is-enabled"
      - "systemctl is-enabled *"
      - "systemctl is-failed"
      - "systemctl is-failed *"
      - "systemctl list-units"
      - "systemctl list-units *"
      - "systemctl list-unit-files"
      - "systemctl list-unit-files *"
      - "systemctl list-timers"
      - "systemctl list-timers *"
      - "systemctl list-sockets"
      - "systemctl list-sockets *"
      - "systemctl list-jobs"
      - "systemctl list-jobs *"
      - "systemctl list-dependencies"
      - "systemctl list-dependencies *"
      - "systemctl show"
      - "systemctl show *"
      - "systemctl cat"
      - "systemctl cat *"
      - "systemctl help"
      - "systemctl help *"
      - "systemctl --version"
      - "strace"
      - "strace *"
      - "ltrace"
      - "ltrace *"
    decision: allow

  # Systemctl management - deny
  - patterns:
      - "systemctl start"
      - "systemctl start *"
      - "systemctl stop"
      - "systemctl stop *"
      - "systemctl restart"
      - "systemctl restart *"
      - "systemctl enable"
      - "systemctl enable *"
      - "systemctl disable"
      - "systemctl disable *"
      - "systemctl mask"
      - "systemctl mask *"
      - "systemctl unmask"
      - "systemctl unmask *"
      - "systemctl daemon-reload"
      - "systemctl daemon-reload *"
    decision: deny
    reason: "Managing services requires user confirmation - the user needs to run this command"

  # ─────────────────────────────────────────────────────────────────────────────
  # File info and checksums - constrained to cwd
  # ─────────────────────────────────────────────────────────────────────────────
  - patterns:
      - "readlink"
      - "readlink *"
      - "realpath"
      - "realpath *"
      - "namei"
      - "namei *"
      - "getfacl"
      - "getfacl *"
      - "lsattr"
      - "lsattr *"
    decision: allow
    constraints:
      - cwd_only
    reason: "Cannot get file info outside working directory"

  # Checksums - constrained to cwd
  - patterns:
      - "md5sum"
      - "md5sum *"
      - "sha1sum"
      - "sha1sum *"
      - "sha256sum"
      - "sha256sum *"
      - "sha512sum"
      - "sha512sum *"
      - "sha224sum"
      - "sha224sum *"
      - "sha384sum"
      - "sha384sum *"
      - "b2sum"
      - "b2sum *"
      - "cksum"
      - "cksum *"
      - "sum"
      - "sum *"
    decision: allow
    constraints:
      - cwd_only
    reason: "Cannot compute checksums for files outside working directory"

  # Diff/compare - constrained to cwd
  - patterns:
      - "diff"
      - "diff *"
      - "cmp"
      - "cmp *"
      - "comm"
      - "comm *"
    decision: allow
    constraints:
      - cwd_only
    reason: "Cannot compare files outside working directory"

  # ─────────────────────────────────────────────────────────────────────────────
  # Text processing
  # ─────────────────────────────────────────────────────────────────────────────
  - patterns:
      - "tr"
      - "tr *"
      - "tee"
      - "tee *"
      - "rev"
      - "rev *"
      - "nl"
      - "nl *"
      - "expand"
      - "expand *"
      - "unexpand"
      - "unexpand *"
      - "fold"
      - "fold *"
      - "fmt"
      - "fmt *"
      - "join"
      - "join *"
      - "split"
      - "split *"
      - "csplit"
      - "csplit *"
      - "colrm"
      - "colrm *"
      - "pr"
      - "pr *"
      - "tsort"
      - "tsort *"
      - "numfmt"
      - "numfmt *"
      - "base64"
      - "base64 *"
      - "base32"
      - "base32 *"
      - "od"
      - "od *"
      - "xxd"
      - "xxd *"
      - "hexdump"
      - "hexdump *"
      - "strings"
      - "strings *"
      - "iconv"
      - "iconv *"
    decision: allow

  # ─────────────────────────────────────────────────────────────────────────────
  # Network diagnostics - read-only
  # ─────────────────────────────────────────────────────────────────────────────
  - patterns:
      - "ip addr"
      - "ip addr *"
      - "ip link show"
      - "ip link show *"
      - "ip route show"
      - "ip route show *"
      - "ip route get"
      - "ip route get *"
      - "ip neigh"
      - "ip neigh *"
      - "ip -s"
      - "ip -s *"
      - "ip a"
      - "ip a *"
      - "ip r"
      - "ip r *"
    decision: allow

  # IP management - deny
  - patterns:
      - "ip link set"
      - "ip link set *"
      - "ip route add"
      - "ip route add *"
      - "ip route del"
      - "ip route del *"
    decision: deny
    reason: "Network interface/route changes require user confirmation - the user needs to run this command"

  - patterns:
      - "ss"
      - "ss *"
      - "netstat"
      - "netstat *"
      - "ifconfig"
      - "ifconfig *"
      - "route"
      - "route *"
      - "dig"
      - "dig *"
      - "nslookup"
      - "nslookup *"
      - "host"
      - "host *"
      - "traceroute"
      - "traceroute *"
      - "tracepath"
      - "tracepath *"
      - "mtr"
      - "mtr *"
      - "whois"
      - "whois *"
      - "arp"
      - "arp *"
      - "ethtool"
      - "ethtool *"
      - "iwconfig"
      - "iwconfig *"
      - "iw"
      - "iw *"
      - "nmcli"
      - "nmcli *"
      - "resolvectl"
      - "resolvectl *"
    decision: allow

  # ─────────────────────────────────────────────────────────────────────────────
  # Archive operations - read/extract only, constrained to cwd
  # ─────────────────────────────────────────────────────────────────────────────
  - patterns:
      - "tar tf"
      - "tar tf *"
      - "tar --list"
      - "tar --list *"
      - "tar -tf"
      - "tar -tf *"
      - "tar -tvf"
      - "tar -tvf *"
      - "tar -xf"
      - "tar -xf *"
      - "tar -xvf"
      - "tar -xvf *"
      - "tar -xzf"
      - "tar -xzf *"
      - "tar -xjf"
      - "tar -xjf *"
    decision: allow
    constraints:
      - cwd_only
    reason: "Cannot extract archives outside working directory"

  # Tar creation - deny
  - patterns:
      - "tar cf"
      - "tar cf *"
      - "tar czf"
      - "tar czf *"
      - "tar cjf"
      - "tar cjf *"
    decision: deny
    reason: "Creating archives requires user confirmation - the user needs to run this command"

  - patterns:
      - "unzip"
      - "unzip *"
      - "zipinfo"
      - "zipinfo *"
      - "zcat"
      - "zcat *"
      - "zless"
      - "zless *"
      - "zmore"
      - "zmore *"
      - "zgrep"
      - "zgrep *"
      - "gunzip"
      - "gunzip *"
      - "gzip -l"
      - "gzip -l *"
      - "gzip -t"
      - "gzip -t *"
      - "xz -l"
      - "xz -l *"
      - "xz -t"
      - "xz -t *"
      - "xzcat"
      - "xzcat *"
      - "unxz"
      - "unxz *"
      - "bzip2 -d"
      - "bzip2 -d *"
      - "bunzip2"
      - "bunzip2 *"
      - "bzcat"
      - "bzcat *"
      - "7z l"
      - "7z l *"
      - "7z x"
      - "7z x *"
      - "7z e"
      - "7z e *"
      - "unrar"
      - "unrar *"
    decision: allow
    constraints:
      - cwd_only
    reason: "Cannot extract archives outside working directory"

  # Archive creation - deny
  - patterns:
      - "zip"
      - "zip *"
      - "gzip"
      - "gzip *"
      - "bzip2"
      - "bzip2 *"
      - "xz"
      - "xz *"
    decision: deny
    reason: "Creating/compressing archives requires user confirmation - the user needs to run this command"

  # ─────────────────────────────────────────────────────────────────────────────
  # Date, time, math utilities
  # ─────────────────────────────────────────────────────────────────────────────
  - patterns:
      - "date"
      - "date *"
      - "cal"
      - "cal *"
      - "ncal"
      - "ncal *"
      - "bc"
      - "bc *"
      - "dc"
      - "dc *"
      - "expr"
      - "expr *"
      - "seq"
      - "seq *"
      - "shuf"
      - "shuf *"
      - "factor"
      - "factor *"
    decision: allow

  # ─────────────────────────────────────────────────────────────────────────────
  # Environment inspection
  # ─────────────────────────────────────────────────────────────────────────────
  - patterns:
      - "env"
      - "printenv"
      - "printenv *"
      - "set"
      - "declare -p"
      - "declare -p *"
      - "type"
      - "type *"
      - "command -v"
      - "command -v *"
      - "hash"
      - "hash *"
    decision: allow

  # Environment modification - deny
  - patterns:
      - "export"
      - "export *"
    decision: deny
    reason: "Environment modification doesn't persist - set variables inline with commands instead"

  - patterns:
      - "unset"
      - "unset *"
    decision: deny
    reason: "Environment modification doesn't persist across commands"

  # ─────────────────────────────────────────────────────────────────────────────
  # Man pages and help
  # ─────────────────────────────────────────────────────────────────────────────
  - patterns:
      - "man"
      - "man *"
      - "info"
      - "info *"
      - "apropos *"
      - "whatis *"
      - "tldr"
      - "tldr *"
      - "help"
      - "help *"
    decision: allow

  # ─────────────────────────────────────────────────────────────────────────────
  # Build tools
  # ─────────────────────────────────────────────────────────────────────────────
  - patterns:
      - "make"
      - "make *"
      - "cmake"
      - "cmake *"
      - "ninja"
      - "ninja *"
      - "meson"
      - "meson *"
      - "autoconf"
      - "autoconf *"
      - "automake"
      - "automake *"
      - "configure"
      - "configure *"
      - "gcc"
      - "gcc *"
      - "g++"
      - "g++ *"
      - "clang"
      - "clang *"
      - "clang++"
      - "clang++ *"
      - "cc"
      - "cc *"
      - "c++"
      - "c++ *"
      - "ld"
      - "ld *"
      - "ar"
      - "ar *"
      - "nm"
      - "nm *"
      - "objdump"
      - "objdump *"
      - "readelf"
      - "readelf *"
      - "size"
      - "size *"
    decision: allow

  # Go
  - patterns:
      - "go build"
      - "go build *"
      - "go test"
      - "go test *"
      - "go run"
      - "go run *"
      - "go mod"
      - "go mod *"
      - "go fmt"
      - "go fmt *"
      - "go vet"
      - "go vet *"
      - "go doc"
      - "go doc *"
      - "go list"
      - "go list *"
      - "go env"
      - "go env *"
      - "go version"
      - "go version *"
      - "go generate"
      - "go generate *"
      - "go clean"
      - "go clean *"
    decision: allow

  # Rust
  - patterns:
      - "rustc"
      - "rustc *"
      - "rustup show"
      - "rustup show *"
      - "rustup which"
      - "rustup which *"
      - "rustup doc"
      - "rustup doc *"
      - "rustup --version"
      - "rustfmt"
      - "rustfmt *"
      - "rust-analyzer"
      - "rust-analyzer *"
    decision: allow

  # ─────────────────────────────────────────────────────────────────────────────
  # Package management - npm
  # ─────────────────────────────────────────────────────────────────────────────
  - patterns:
      - "npm install"
      - "npm install *"
      - "npm i *"
      - "npm uninstall"
      - "npm uninstall *"
      - "npm update"
      - "npm update *"
      - "npm publish"
      - "npm publish *"
    decision: deny
    reason: "Package installation/mutation requires user confirmation - the user needs to run this command"

  - patterns:
      - "npm info"
      - "npm info *"
      - "npm run"
      - "npm run *"
      - "npm audit"
      - "npm audit *"
      - "npm search"
      - "npm search *"
      - "npm view"
      - "npm view *"
      - "npm list"
      - "npm list *"
      - "npm ls"
      - "npm ls *"
      - "npm outdated"
      - "npm outdated *"
      - "npm explain"
      - "npm explain *"
      - "npm why"
      - "npm why *"
      - "npm fund"
      - "npm fund *"
      - "npm doctor"
      - "npm doctor *"
      - "npm prefix"
      - "npm prefix *"
      - "npm root"
      - "npm root *"
      - "npm bin"
      - "npm bin *"
      - "npm config list"
      - "npm config list *"
      - "npm config get"
      - "npm config get *"
      - "npm pack"
      - "npm pack *"
      - "npm version"
      - "npm help"
      - "npm help *"
      - "npm exec"
      - "npm exec *"
      - "npm test"
      - "npm test *"
      - "npm start"
      - "npm start *"
      - "npm rebuild"
      - "npm rebuild *"
      - "npm dedupe"
      - "npm dedupe *"
      - "npm prune"
      - "npm prune *"
    decision: allow

  # ─────────────────────────────────────────────────────────────────────────────
  # Package management - yarn
  # ─────────────────────────────────────────────────────────────────────────────
  - patterns:
      - "yarn add"
      - "yarn add *"
      - "yarn remove"
      - "yarn remove *"
      - "yarn upgrade"
      - "yarn upgrade *"
      - "yarn publish"
      - "yarn publish *"
    decision: deny
    reason: "Package installation/mutation requires user confirmation - the user needs to run this command"

  - patterns:
      - "yarn audit"
      - "yarn audit *"
      - "yarn info"
      - "yarn info *"
      - "yarn list"
      - "yarn list *"
      - "yarn why"
      - "yarn why *"
      - "yarn outdated"
      - "yarn outdated *"
      - "yarn config list"
      - "yarn config list *"
      - "yarn config get"
      - "yarn config get *"
      - "yarn version"
      - "yarn versions"
      - "yarn cache list"
      - "yarn cache list *"
      - "yarn workspaces list"
      - "yarn workspaces list *"
      - "yarn licenses list"
      - "yarn licenses list *"
      - "yarn run"
      - "yarn run *"
      - "yarn build"
      - "yarn build *"
      - "yarn test"
      - "yarn test *"
      - "yarn lint"
      - "yarn lint *"
      - "yarn start"
      - "yarn start *"
      - "yarn dedupe"
      - "yarn dedupe *"
      - "yarn explain"
      - "yarn explain *"
      - "yarn pack"
      - "yarn pack *"
      - "yarn help"
      - "yarn help *"
    decision: allow

  # ─────────────────────────────────────────────────────────────────────────────
  # Package management - pnpm
  # ─────────────────────────────────────────────────────────────────────────────
  - patterns:
      - "pnpm add"
      - "pnpm add *"
      - "pnpm i *"
      - "pnpm install *"
      - "pnpm remove *"
      - "pnpm update *"
      - "pnpm publish *"
    decision: deny
    reason: "Package installation/mutation requires user confirmation - the user needs to run this command"

  - patterns:
      - "pnpm audit"
      - "pnpm audit *"
      - "pnpm list"
      - "pnpm list *"
      - "pnpm ls"
      - "pnpm ls *"
      - "pnpm outdated"
      - "pnpm outdated *"
      - "pnpm why"
      - "pnpm why *"
      - "pnpm licenses list"
      - "pnpm licenses list *"
      - "pnpm run"
      - "pnpm run *"
      - "pnpm exec"
      - "pnpm exec *"
      - "pnpm env list"
      - "pnpm env list *"
      - "pnpm root"
      - "pnpm root *"
      - "pnpm bin"
      - "pnpm bin *"
      - "pnpm prefix"
      - "pnpm prefix *"
      - "pnpm store status"
      - "pnpm store status *"
      - "pnpm config list"
      - "pnpm config list *"
      - "pnpm config get"
      - "pnpm config get *"
      - "pnpm build"
      - "pnpm test"
      - "pnpm start"
      - "pnpm moon"
      - "pnpm dedupe"
      - "pnpm dedupe *"
      - "pnpm rebuild"
      - "pnpm rebuild *"
      - "pnpm prune"
      - "pnpm prune *"
      - "pnpm pack"
      - "pnpm pack *"
      - "pnpm help"
      - "pnpm help *"
      - "pnpm vitest"
      - "pnpm vitest *"
      - "pnpm i"
      - "pnpm install"
    decision: allow

  # ─────────────────────────────────────────────────────────────────────────────
  # Package management - cargo
  # ─────────────────────────────────────────────────────────────────────────────
  - patterns:
      - "cargo install"
      - "cargo install *"
      - "cargo uninstall"
      - "cargo uninstall *"
      - "cargo publish"
      - "cargo publish *"
    decision: deny
    reason: "Global crate installation/publishing requires user confirmation - the user needs to run this command"

  - patterns:
      - "cargo add"
      - "cargo add *"
      - "cargo check"
      - "cargo check *"
      - "cargo build"
      - "cargo build *"
      - "cargo test"
      - "cargo test *"
      - "cargo run"
      - "cargo run *"
      - "cargo doc"
      - "cargo doc *"
      - "cargo bench"
      - "cargo bench *"
      - "cargo tree"
      - "cargo tree *"
      - "cargo metadata"
      - "cargo metadata *"
      - "cargo search"
      - "cargo search *"
      - "cargo info"
      - "cargo info *"
      - "cargo fetch"
      - "cargo fetch *"
      - "cargo verify-project"
      - "cargo verify-project *"
      - "cargo locate-project"
      - "cargo locate-project *"
      - "cargo read-manifest"
      - "cargo read-manifest *"
      - "cargo pkgid"
      - "cargo pkgid *"
      - "cargo generate-lockfile"
      - "cargo generate-lockfile *"
      - "cargo clippy"
      - "cargo clippy *"
      - "cargo fmt"
      - "cargo fmt *"
      - "cargo audit"
      - "cargo audit *"
      - "cargo fix"
      - "cargo fix *"
      - "cargo clean"
      - "cargo clean *"
      - "cargo vendor"
      - "cargo vendor *"
      - "cargo version"
      - "cargo version *"
      - "cargo --version"
      - "cargo help"
      - "cargo help *"
    decision: allow

  # ─────────────────────────────────────────────────────────────────────────────
  # Build and test tools
  # ─────────────────────────────────────────────────────────────────────────────
  - patterns:
      - "tsc"
      - "tsc *"
      - "eslint"
      - "eslint *"
      - "prettier"
      - "prettier *"
      - "jest"
      - "jest *"
      - "vitest"
      - "vitest *"
      - "pytest"
      - "pytest *"
      - "time"
      - "time *"
      - "hyperfine"
      - "hyperfine *"
      - "perf"
      - "perf *"
    decision: allow

  # ─────────────────────────────────────────────────────────────────────────────
  # Version control - git
  # ─────────────────────────────────────────────────────────────────────────────
  - pattern: "git *"
    decision: allow

  - patterns:
      - "git push"
      - "git push *"
    decision: deny
    reason: "Pushing to remote requires user confirmation - the user needs to push when ready"

  - patterns:
      - "git config *"
      - "git config"
      - "git commit"
      - "git commit *"
    decision: deny
    reason: "No unexpected changes to the host system are allowed - the user needs to run this command"

  - patterns:
      - "git reset --hard"
      - "git reset --hard *"
    decision: deny
    reason: "Hard reset can lose work - the user needs to run this command if they're sure"

  - patterns:
      - "git clean -f"
      - "git clean -f *"
    decision: deny
    reason: "Cleaning untracked files can lose work - the user needs to run this command"

  - patterns:
      - "git rebase"
      - "git rebase *"
    decision: deny
    reason: "Rebasing can rewrite history - the user needs to run this command"

  - patterns:
      - "git force"
      - "git force *"
      - "git *--force"
      - "git *--force *"
      - "git *-f *"
    decision: deny
    reason: "Force operations can lose work - the user needs to run this command"

  # ─────────────────────────────────────────────────────────────────────────────
  # Chezmoi - dotfiles management
  # ─────────────────────────────────────────────────────────────────────────────
  - patterns:
      - "chezmoi"
      - "chezmoi *"
    decision: allow

  - patterns:
      - "chezmoi apply"
      - "chezmoi apply *"
      - "chezmoi update"
      - "chezmoi update *"
      - "chezmoi init"
      - "chezmoi init *"
    decision: deny
    reason: "Applying/updating dotfiles requires user confirmation - the user needs to run this command"
